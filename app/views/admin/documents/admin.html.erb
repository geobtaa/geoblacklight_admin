<div class="row flex-xl-nowrap">
  <main class="col-md-12">
    <h1 style="width:100%;">
      Document &middot; Admin View
    </h1>

    <h3>
      <%= link_to(@document.title, admin_document_path(@document)) %>
    </h3>

    <table class="table table-borderless table-sm">
      <thead>
        <tr>
          <th>Provenance</th>
          <th>Updated At</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= @document.schema_provider_s %></td>
          <td>
            <table>
              <tr>
                <th>Solr</th>
                <td><%= DateTime.parse(@document.raw_solr_document["timestamp"]).strftime('%D %r') %></td>
              </tr>
              <tr>
                <th>Database</th>
                <td><%= @document.updated_at.strftime('%D %r') %></td>  
              </tr>
            </table>
          </td>
        </tr>
      </tbody>
    </table>

    <hr/>
    <!--<h3 id="document">Database Object</h3>
    <div class="database-object">
      <%= ap(JSON.parse(@document.to_json)).html_safe %>
    </div>-->

    <h3 id="solr-document">Solr Document</h3>
    <div class="solr-document">
      <%= ap(JSON.parse(@document.raw_solr_document.to_json)).html_safe %>
    </div>

    <br/>
    <h3>Item Viewer</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Protocol</th>
          <th>Endpoint</th>
        </tr>
      <tbody>
        <tr>
          <td><%= @document.viewer_protocol %></td>
          <td><%= link_to(@document.viewer_endpoint, @document.viewer_endpoint) %></td>
        </tr>
      </tbody>
    </table>

    <h3 id="thumbnail">Thumbnail</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Display</th>
          <th>Attached</th>
          <th>State</th>
          <th>Last Transition</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <% if @document&.thumbnail&.present? %>
            <td>
              <span>AWS S3</span>
              <div class="media">
                <span class="mr-3">
                  <% unless @document&.thumbnail&.file_url(:thumb_mini).nil? %>
                    <%= image_tag @document&.thumbnail&.file_url(:thumb_mini) %>
                  <% end %>
                </span>
              </div>
            </td>
          <% else %>
            <td><span>None</span></td>
          <% end %>
          <td><%= @document.thumbnail.present? %></td>
          <td><%= @document&.thumbnail_state_machine&.current_state %></td>
          <td><%= ap(@document&.thumbnail_state_machine&.last_transition).html_safe %></td>
        </tr>
      </tbody>
    </table>

    <h3 id="references">References</h3>
    <table class="table responsive">
      <thead>
        <tr>
          <th>Key</th>
          <th>Values</th>
        </tr>
      </thead>
      <tbody>
        <% @document.references.each do |entry| %>
          <tr>
            <td><%= entry[0] %></td>
            <td>
              <% if entry[1].is_a?(Array) %>
                <ul>
                  <% entry[1].each do |value| %>
                    <li><%= value %></li>
                  <% end %>
                </ul>
                <% else %>
                  <% if entry[1].is_a?(Hash) %>
                    <ul>
                      <% entry[1].each do |key, value| %>
                        <li><%= key %>: <%= value %></li>
                      <% end %>
                    </ul>
                  <% else %>
                    <p><%= link_to(entry[1], entry[1]) %></p>
                  <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <h3 id="access-links">Access Links</h3>
    <table class="table responsive">
      <thead>
        <tr>
          <th>University</th>
          <th>Access Link</th>
        </tr>
      </thead>
      <tbody>
        <% @document.document_accesses.each do |da| %>
          <tr>
            <td><%= da.institution_code %></td>
            <td><a href="<%= da.access_url %>"><%= da.access_url %></a></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </main>
</div>
